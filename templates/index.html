<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Listening Platform - Lead Generation & Market Research</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Social Listening Platform</h1>
            <p>Lead Generation & Market Research Intelligence</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="scrape">Twitter Scraping</button>
            <button class="tab-btn" data-tab="discover">Account Discovery</button>
            <button class="tab-btn" data-tab="reddit">Reddit Scraping</button>
            <button class="tab-btn" data-tab="schedule">Scheduled Scraping</button>
            <button class="tab-btn" data-tab="history">Report History</button>
        </div>

        <!-- Quick Scrape Tab -->
        <div id="scrape-tab" class="tab-content active">
            <div class="card">
                <form id="scrapeForm">
                    <div class="form-group">
                        <label for="username">Twitter Handle</label>
                        <input 
                            type="text" 
                            id="username" 
                            name="username" 
                            placeholder="e.g., elonmusk (without @)"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="keywords">Keywords (optional)</label>
                        <input 
                            type="text" 
                            id="keywords" 
                            name="keywords" 
                            placeholder="e.g., AI, technology, innovation (comma-separated)"
                        >
                        <small>Leave empty to get all recent tweets</small>
                    </div>

                    <div class="form-group">
                        <label for="min-keyword-mentions">Minimum Keyword Mentions</label>
                        <input 
                            type="number" 
                            id="min-keyword-mentions" 
                            placeholder="e.g., 5 (default: 1)"
                            min="1"
                            value="1"
                        >
                        <small>Only show keywords mentioned at least this many times</small>
                    </div>

                    <div class="advanced-filters">
                        <h3>üéØ Advanced Filters (Lead Generation)</h3>
                        
                        <div class="filter-row">
                            <div class="form-group">
                                <label for="min-likes">Minimum Likes</label>
                                <input 
                                    type="number" 
                                    id="min-likes" 
                                    placeholder="e.g., 10"
                                    min="0"
                                >
                            </div>

                            <div class="form-group">
                                <label for="min-retweets">Minimum Retweets</label>
                                <input 
                                    type="number" 
                                    id="min-retweets" 
                                    placeholder="e.g., 5"
                                    min="0"
                                >
                            </div>

                            <div class="form-group">
                                <label for="min-replies">Minimum Replies</label>
                                <input 
                                    type="number" 
                                    id="min-replies" 
                                    placeholder="e.g., 2"
                                    min="0"
                                >
                            </div>
                        </div>

                        <div class="filter-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" id="has-links">
                                <span>Only tweets with links</span>
                            </label>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="has-media">
                                <span>Only tweets with media</span>
                            </label>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="no-retweets">
                                <span>Exclude retweets</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" id="submitBtn" class="btn-primary">
                        <span id="btnText">Generate Report</span>
                        <span id="btnLoader" class="loader" style="display: none;"></span>
                    </button>
                </form>
            </div>

            <div id="results" class="results" style="display: none;">
                <div class="card success">
                    <h2>‚úì Report Generated!</h2>
                    <p id="resultMessage"></p>
                    <div class="action-buttons">
                        <button id="viewReportBtn" class="btn-action">
                            üëÅÔ∏è View Report
                        </button>
                        <a id="downloadTxt" class="btn-download" download>
                            üìÑ Download Report (.txt)
                        </a>
                        <a id="downloadJson" class="btn-download" download>
                            üìä Download Raw Data (.json)
                        </a>
                    </div>
                </div>
            </div>

            <div id="error" class="results" style="display: none;">
                <div class="card error">
                    <h2>‚ö†Ô∏è Error</h2>
                    <p id="errorMessage"></p>
                </div>
            </div>
        </div>

        <!-- Account Discovery Tab -->
        <div id="discover-tab" class="tab-content">
            <div class="card">
                <h2>üîç Account Discovery</h2>
                <p>Search for Twitter accounts based on keywords or find accounts similar to a reference account</p>
                
                <form id="discoverForm">
                    <!-- Discovery Mode Toggle -->
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="similar-mode-toggle" style="width: auto;">
                            <span>Find accounts similar to a reference account</span>
                        </label>
                    </div>

                    <!-- Keyword Search (default) -->
                    <div id="keyword-search-section">
                        <div class="form-group">
                            <label for="discover-keywords">Search Keywords</label>
                            <input 
                                type="text" 
                                id="discover-keywords" 
                                placeholder="e.g., GCC, manufacturing, Pune (comma-separated)"
                            >
                            <small>Find accounts that have tweeted about these topics</small>
                        </div>
                    </div>

                    <!-- Similar Account Search -->
                    <div id="similar-search-section" style="display: none;">
                        <div class="form-group">
                            <label for="reference-username">Reference Account</label>
                            <input 
                                type="text" 
                                id="reference-username" 
                                placeholder="e.g., @elonmusk or elonmusk"
                            >
                            <small>We'll analyze this account and find similar ones</small>
                        </div>
                        <div id="reference-preview" style="display: none; padding: 15px; background: #f7f9fa; border-radius: 8px; margin-top: 10px;">
                            <strong>Reference Account:</strong>
                            <div id="reference-info" style="margin-top: 8px;"></div>
                        </div>
                    </div>

                    <div class="advanced-filters">
                        <h3>üéØ Quality Filters</h3>
                        
                        <div class="filter-row">
                            <div class="form-group">
                                <label for="discover-min-followers">Minimum Followers</label>
                                <select id="discover-min-followers">
                                    <option value="0">Any</option>
                                    <option value="50">50+</option>
                                    <option value="100">100+</option>
                                    <option value="500">500+</option>
                                    <option value="1000" selected>1,000+</option>
                                    <option value="5000">5,000+</option>
                                    <option value="10000">10,000+</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="discover-max-results">Max Tweets to Search</label>
                                <select id="discover-max-results">
                                    <option value="50">50 tweets</option>
                                    <option value="100" selected>100 tweets</option>
                                </select>
                            </div>
                        </div>

                        <div class="filter-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" id="discover-verified-only">
                                <span>Verified accounts only</span>
                            </label>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="discover-has-links">
                                <span>Must have links in tweets</span>
                            </label>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="discover-exclude-retweets" checked>
                                <span>Exclude retweets</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" id="discoverBtn" class="btn-primary">
                        <span id="discoverBtnText">üîç Discover Accounts</span>
                        <span id="discoverBtnLoader" class="loader" style="display: none;"></span>
                    </button>
                </form>
            </div>

            <!-- Discovery Results -->
            <div id="discovery-results" style="display: none;">
                <div class="card">
                    <div class="schedules-header">
                        <h3>üìã Discovered Accounts</h3>
                        <span id="accounts-count" class="status-label status-active">0 accounts</span>
                    </div>
                    
                    <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <button id="select-all-accounts" class="btn-action">Select All (Page)</button>
                            <button id="select-all-visible" class="btn-action">Select All Visible</button>
                            <button id="deselect-all-accounts" class="btn-action">Deselect All</button>
                            <button id="bulk-scrape-btn" class="btn-primary" style="margin-left: 10px;">
                                üìä Bulk Scrape Selected (<span id="selected-count">0</span>)
                            </button>
                        </div>
                        <div>
                            <label for="accounts-per-page" style="margin-right: 8px;">Show:</label>
                            <select id="accounts-per-page" style="padding: 5px;">
                                <option value="10" selected>10 per page</option>
                                <option value="25">25 per page</option>
                                <option value="50">50 per page</option>
                                <option value="all">All</option>
                            </select>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <label for="sort-accounts" style="margin-right: 8px;">Sort by:</label>
                            <select id="sort-accounts" style="padding: 5px;">
                                <option value="quality">Quality Score</option>
                                <option value="followers">Followers</option>
                                <option value="relevance">Relevance</option>
                            </select>
                            <label for="filter-type" style="margin-left: 15px; margin-right: 8px;">Show:</label>
                            <select id="filter-type" style="padding: 5px;">
                                <option value="all">All Accounts</option>
                                <option value="business">Business Only</option>
                                <option value="professional">Professional Only</option>
                                <option value="verified">Verified Only</option>
                            </select>
                        </div>
                        <div id="accounts-range" style="color: #657786; font-size: 14px;"></div>
                    </div>

                    <div id="accounts-container"></div>

                    <!-- Pagination Controls -->
                    <div id="pagination-controls" style="display: flex; justify-content: center; align-items: center; margin-top: 20px; gap: 10px;">
                        <button id="first-page" class="btn-action" disabled>¬´ First</button>
                        <button id="prev-page" class="btn-action" disabled>‚Äπ Prev</button>
                        <div id="page-numbers" style="display: flex; gap: 5px;"></div>
                        <button id="next-page" class="btn-action">Next ‚Ä∫</button>
                        <button id="last-page" class="btn-action">Last ¬ª</button>
                    </div>
                </div>
            </div>

            <!-- Bulk Scrape Progress -->
            <div id="bulk-progress" style="display: none;">
                <div class="card">
                    <h3>‚è≥ Bulk Scraping in Progress...</h3>
                    <div id="bulk-progress-details"></div>
                </div>
            </div>

            <!-- Bulk Scrape Results -->
            <div id="bulk-results" style="display: none;">
                <div class="card success">
                    <h2>‚úì Bulk Scraping Complete!</h2>
                    <p id="bulk-results-message"></p>
                    <div id="bulk-results-details"></div>
                </div>
            </div>

            <div id="discover-error" class="results" style="display: none;">
                <div class="card error">
                    <h2>‚ö†Ô∏è Error</h2>
                    <p id="discoverErrorMessage"></p>
                </div>
            </div>
        </div>

        <!-- Reddit Scraping Tab -->
        <div id="reddit-tab" class="tab-content">
            <div class="card">
                <h2>üîç Reddit Scraping</h2>
                <form id="redditForm">
                    <div class="form-group">
                        <label for="subreddit">Subreddit Name</label>
                        <input 
                            type="text" 
                            id="subreddit" 
                            name="subreddit" 
                            placeholder="e.g., startups, SaaS, entrepreneur (without r/)"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="reddit-keywords">Keywords (optional)</label>
                        <input 
                            type="text" 
                            id="reddit-keywords" 
                            name="keywords" 
                            placeholder="e.g., AI, B2B, funding (comma-separated)"
                        >
                        <small>Leave empty to get all recent posts</small>
                    </div>

                    <div class="form-group">
                        <label for="reddit-min-keyword-mentions">Minimum Keyword Mentions</label>
                        <input 
                            type="number" 
                            id="reddit-min-keyword-mentions" 
                            placeholder="e.g., 5 (default: 1)"
                            min="1"
                            value="1"
                        >
                        <small>Only show keywords mentioned at least this many times</small>
                    </div>

                    <div class="form-group">
                        <label for="time-filter">Time Filter</label>
                        <select id="time-filter">
                            <option value="hour">Past Hour</option>
                            <option value="day">Past 24 Hours</option>
                            <option value="week" selected>Past Week</option>
                            <option value="month">Past Month</option>
                            <option value="year">Past Year</option>
                            <option value="all">All Time</option>
                        </select>
                    </div>

                    <button type="submit" id="redditSubmitBtn" class="btn-primary">
                        <span id="redditBtnText">Generate Report</span>
                        <span id="redditBtnLoader" class="loader" style="display: none;"></span>
                    </button>
                </form>
            </div>

            <div id="reddit-results" class="results" style="display: none;">
                <div class="card success">
                    <h2>‚úì Report Generated!</h2>
                    <p id="redditResultMessage"></p>
                    <div class="action-buttons">
                        <button id="viewRedditReportBtn" class="btn-action">
                            üëÅÔ∏è View Report
                        </button>
                        <a id="redditDownloadTxt" class="btn-download" download>
                            üìÑ Download Report (.txt)
                        </a>
                        <a id="redditDownloadJson" class="btn-download" download>
                            üìä Download Raw Data (.json)
                        </a>
                    </div>
                </div>
            </div>

            <div id="reddit-error" class="results" style="display: none;">
                <div class="card error">
                    <h2>‚ö†Ô∏è Error</h2>
                    <p id="redditErrorMessage"></p>
                </div>
            </div>
        </div>

        <!-- Schedule Tab -->
        <div id="schedule-tab" class="tab-content">
            <div class="card">
                <h2>üìÖ Schedule Automatic Scraping</h2>
                <p>Build historical data by scheduling regular scrapes (works around 7-day API limit)</p>
                
                <div class="timezone-notice">
                    ‚è∞ <strong>Timezone:</strong> All times are in <strong>UTC</strong> (Coordinated Universal Time)
                    <br>
                    <small>
                        Current UTC time: <span id="utc-time"></span> | 
                        Your local time: <span id="local-time"></span>
                    </small>
                </div>
                
                <form id="scheduleForm">
                    <div class="form-group">
                        <label for="schedule-username">Twitter Handle</label>
                        <input 
                            type="text" 
                            id="schedule-username" 
                            placeholder="e.g., elonmusk"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="schedule-keywords">Keywords (optional)</label>
                        <input 
                            type="text" 
                            id="schedule-keywords" 
                            placeholder="e.g., AI, technology"
                        >
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="schedule-start-datetime">Start Date & Time (UTC)</label>
                            <input 
                                type="datetime-local" 
                                id="schedule-start-datetime"
                                required
                            >
                            <small>First run will be at this date/time</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="schedule-frequency">Repeat Frequency</label>
                            <select id="schedule-frequency">
                                <option value="once">Once (no repeat)</option>
                                <option value="hourly">Every Hour</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                            </select>
                            <small>How often to repeat after the start time</small>
                        </div>

                        <div class="form-group" id="day-selector" style="display: none;">
                            <label for="schedule-day">Day of Week</label>
                            <select id="schedule-day">
                                <option value="monday">Monday</option>
                                <option value="tuesday">Tuesday</option>
                                <option value="wednesday">Wednesday</option>
                                <option value="thursday">Thursday</option>
                                <option value="friday">Friday</option>
                                <option value="saturday">Saturday</option>
                                <option value="sunday">Sunday</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary">
                        ‚ûï Add Schedule
                    </button>
                </form>

                <div id="schedules-list" class="schedules-list">
                    <div class="schedules-header">
                        <h3>Active Schedules</h3>
                        <span id="schedule-status" class="status-label status-inactive">Loading...</span>
                    </div>
                    <div id="schedules-container"></div>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history-tab" class="tab-content">
            <div class="card">
                <h2>üìö Report History</h2>
                <p>View and access all previously generated reports</p>
                
                <!-- Pagination Controls -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div id="reports-range" style="color: #657786; font-size: 14px;"></div>
                    <div>
                        <label for="reports-per-page" style="margin-right: 8px;">Show:</label>
                        <select id="reports-per-page" style="padding: 5px;">
                            <option value="10" selected>10 per page</option>
                            <option value="25">25 per page</option>
                            <option value="50">50 per page</option>
                            <option value="all">All</option>
                        </select>
                    </div>
                </div>
                
                <div id="reports-list" class="reports-list">
                    <div id="reports-container">Loading...</div>
                </div>
                
                <!-- Pagination Controls -->
                <div id="reports-pagination-controls" style="display: flex; justify-content: center; align-items: center; margin-top: 20px; gap: 10px;">
                    <button id="reports-first-page" class="btn-action" disabled>¬´ First</button>
                    <button id="reports-prev-page" class="btn-action" disabled>‚Äπ Prev</button>
                    <div id="reports-page-numbers" style="display: flex; gap: 5px;"></div>
                    <button id="reports-next-page" class="btn-action">Next ‚Ä∫</button>
                    <button id="reports-last-page" class="btn-action">Last ¬ª</button>
                </div>
            </div>
        </div>

        <!-- Report Viewer Modal -->
        <div id="reportViewer" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìä Report Viewer</h2>
                    <button id="closeModal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <pre id="reportContent"></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
